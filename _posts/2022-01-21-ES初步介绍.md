---
title: ES初识
author: Yahui
layout: sql
category: SQL
---

书名：《-》

<pre style="text-align: left;">
	提示:
		默认端口9200
	1.核心
		1.搜索,聚合分析,大数据存储
		2.分布式,高性能,高可用,易扩展,易维护
		3.支持文本搜索,结构化数据,非结构化数据,地理位置搜索等(全文检索只是全球众多公司利用ES解决各种挑战的一小部分)
	2.下载
		1.安装Java
		2.安装ES(https://www.elastic.co/cn/downloads/elasticsearch)
			解压后,直接执行bin/elasticsearch.bat即可
			访问http://localhost:9200/
		3.安装kibana(ES的客户端工具https://www.elastic.co/cn/downloads/kibana)
			解压后,直接执行bin/kibana.bat即可
			访问http://localhost:5601
			配置ES服务地址:kibana
			(可以配置中文插件i18n.locale: "zh-CN")
		4.安装Head插件(界面插件git://github.com/mobz/elasticsearch-head.git)
			下载并配置
				// README.textile内容
				git clone git://github.com/mobz/elasticsearch-head.git
				cd elasticsearch-head
				npm install
				npm run start
				open http://localhost:9100
			ES的配置文件(elasticsearch.yml)
				// 如果需要修改服务地址
				network.host: 192.168.0.1
				cluster.initial_master_nodes: ["node-1", "node-2"]
				// 如果访问跨域报错
				http.cors.enabled: true
				http.cors.allow-origin: "*"
		5.安装IK中文分词器插件(https://github.com/medcl/elasticsearch-analysis-ik/releases)
			下载后直接放入ES的插件目录中即可(不是下载的源码,而是jar包)
	3.理解
		1.ES是面向文档,关系型数据库进行对比
			数据库 -> 索引(indices)
			表 -> types(逐渐就被废弃掉)
			行 -> document
			字段 -> fields
		2.一个分片是一个Lucene索引, 一个包含倒排索引的文件目录
		3.查看ik分词
			GET _analyze
			{
			  "analyzer": "ik_smart", // 
			  "text": ["中国人民好幸福"]
			}
			GET _analyze
			{
			  "analyzer": "ik_max_word", // 最大粒度分词
			  "text": ["中国人民好幸福"]
			}
			如果分词并不是想要的, 可以进行手动修改(注意,修改的时候编码必须为utf-8)
			1.在ik插件config目录中,可以看到很多dic的分词文档
			2.创建自定义dic文档
			3.想要认为是一个词的写入文档的一行保存(test.dic, 首行写入"八重神子")
			4.修改配置文件(IKAnalyzer.cfg.xml),将新增的dic文档添加进去
			5.重启ES("八重神子"就会被当做一个完整的词)
	4.操作(Rest风格)
		(同理,这样也是可以使用postman等工具发送请求)
		1.PUT
			声明:
				(增加,如果已经存在则会更新(注意的是,如果是更新,没有的字段则会被删除,所以一般还是处理新增操作))
			模式:
				PUT /index_name(索引名)/type_name(类型(未来就不用了,默认是_doc))/1(文档id)
				{
					(请求体)
				  "name":"heihei",
				  "age":10086
				}
			返回结果:
				{
					"_index" : "index_name",
					"_type" : "type_name",
					"_id" : "1",
					"_version" : 1, // 如果修改的话,版本号会增加
					"result" : "created",
					"_shards" : {
						"total" : 2,
						"successful" : 1,
						"failed" : 0
					},
					"_seq_no" : 0,
					"_primary_term" : 1
				}
			例:
				PUT /test2
				{
					"mappings" : { // 规则
						"properties" : { // 属性
							"name" :{
								"type" : "text"
							},
							"age" :{
								"type" : "long" // 如果类型是keyword,则不会被分词(可以用_analyze来查看)
							}
						}
					}
				}
		2.POST
			1./索引名/类型 (创建)
				POST /index_name/_doc/
				{
				    "name": "hahaha"
				}
			2./索引名/类型/文档id/_update (更新)
				POST /index_name/_doc/1/_update
				{
				  "doc": {
				    "name": "hahaha"
				  }
				}
			3./索引名/类型/_search (查询所有)
				POST /index_name/_doc/_search?q=name:haha
				{
					"took" : 0,
					"timed_out" : false,
					"_shards" : {
						"total" : 1,
						"successful" : 1,
						"skipped" : 0,
						"failed" : 0
					},
					"hits" : {
						"total" : {
						  "value" : 5,
						  "relation" : "eq"
						},
						"max_score" : 0.08701137, // 匹配度
						"hits" : [
							{
								"_index" : "index_name",
								"_type" : "_doc",
								"_id" : "1",
								"_score" : 0.08701137, // 匹配度
								"_source" : {
									"name" : "hahaha",
									"age" : 100089
								}
							},
							{...}
						]
					}
				}
		3.DELETE
			1./索引名称 (删除索引)
			2./索引名称/类型/文档id (删除文档)
		4.GET
			/索引名称/类型/文档id (根据ID查询)
			/索引名称(/类型,也可以不加)/_search (根据条件查询,与POST一样)
				GET /index_name/_doc/_search
				{
				  "query": {
				    /*多条件精确查询*/
				    "bool": {
				      "must": [ // 相当于and查询 -> "must_not"
				      "should": [ // 相当于or查询 -> "should_not"
				        {
				          "match": { // 会使用分词器进行查找,如果用term则是精确查找
				            "name": "hahaha",
				            "tag":"男 技术" // 多个条件查询,只用空格隔开即可
				          },
				          {
				            ...
				          }
				        }
				      ],
				      "filter":{
				        "range":{
				          "age":{
				            "gte":10, // 区间查找
				            "let":50
				          }
				        }
				      }
				    }
				  },
				  "_source": [
				    "name"
				  ],
				  "sort": [
				    {
				      "age": {
				        "order": "desc"
				      }
				    }
				  ],
				  "highlight":{ // 高亮查询
				    "pre_tags":"<p class='key' style 'color:red'>", // 自定义标签
				    "post_tags":"</p>",
				      "fields": {
				        "name": {}
				      }
				  },
				  "from": 0, // 分页查询
				  "size": 2
				}
		<span class="image featured"><img src="{{ 'assets/images/other/Go-GinBase.jpg' | relative_url }}" alt="" /></span>
</pre>