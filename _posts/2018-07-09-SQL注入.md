---
title: SQL注入随手笔记
author: Yahui
layout: php
category: PHP
---

什么是SQL注入

将SQL代码添加到输入的参数中，传递到SQL服务器解析并执行的一种攻击手法。

SQL注入产生的原因

1、开发人员无法保证所有的输入都已经过滤

2、攻击者利用发送给SQL服务器的输入数据构造可执行的SQL代码

3、数据库未做相应的安全配置

SQL注入攻击

1、数字攻击
(id = -1 OR 1=1)

2、字符串攻击
SQL中，注释是使用'#'或者'-- '所以可以使用(name='aaa'#'password='123')绕过密码的验证

SQL预防
1、数字攻击
(强制转换)

2、字符串攻击
(长度字符的限制、addslashes过滤、或者使用mysqli扩展中mysqli_real_escape_string过滤、mysqli的预编译机制)

$db = mysqli_connect('...');

mysqli_set_charset($db,'utf8');

$sql = 'SELECT id,user_name FROM ...?...?';

$stmt = mysqli_prepare($db,$sql);

mysqli_stmt_bind_param($stmt,'ss',$user_name,$password);

mysqli_stmt_execute($stmt);

mysqli_stmt_bind_result($stmt,$id,$username);

mysqli_stmt_fetch($stmt);