---
title: Oracle Database 9i 10g 11g编程艺术 深入数据库体系结构
author: Yahui
layout: sql
category: SQL
---

书名:《Oracle Database 9i 10g 11g编程艺术 深入数据库体系结构》

<pre style="text-align: left;">
	----------------------------------以下引自(动力节点Oracle入门教程)-----------------------------------
	PL/SQL:
		1.Oracle数据库对SQL语句的扩展.在普通SQL语句的使用上增加了编程语言的特点,所以PL/SQL把数据操作和查询语句组织在PL/SQL代码的过程性单元中,通过逻辑判断、循环等操作实现复杂的功能或者计算.
		2.声明部分(用declare开头),执行部分(以 begin开头)和异常处理部分(以exception开头),其中执行部分是必须的,其他两个部分可选.
			在begin部分可以使用declare部分声明的变量
			(可以进行嵌套)
			DECLARE
			BEGIN
			EXCEPTION
				DECLARE
				BEGIN
				EXCEPTION
				END;
			END;
		3.存储过程和PLSQL有什么区别？
			PLSQL只能调用一次，而存储过程可以存放在数据库服务器中，我们可以通过存储过程名多次调用。
		4.存储过程参数问题
			IN类型:传递给子程序,参数可以是常量,表达式,或者初始化的变量
			OUT类型:返回到调用环境,参数未初始化的变量,必须是一个变量
			IN-OUT类型:传递给子程序返回到调用环境,参数为初始化的变量,必须是一个变量
		5.触发器
			CREATE OR REPLACE TRIGGER 触发器名称
				-- 也可以多个比如:INSERT OR UPDATE
				BEFORE INSERT ON 表名
				-- 行级触发器加上下面这句
				FOR EACH ROW
			DECLARE
				-- 声明变量V_ID
				SELECT ID INTO V_ID FROM 表 WHERE 条件
			BEGIN
				-- :NEW.nick_name可以表示新插入的数据nick_name这一字段,对应的还有OLD
				IF()
				THEN
					-- 提示一条用户自定义的错误信息,通过这个信息,终端用户的的操作
					RAISE_APPLICATION_ERROR(20500,'错误提示信息');
				END_IF;
			END;

			DDL触发器语法
				CREATE OR REPLACE TRIGGER 触发器名称
					-- 也可以多个比如:INSERT OR UPDATE
					AFTER LOGON ON 库名
				BEGIN
					-- 可以向日志表存储登录信息
					INSERT INTO ....
				END;
	----------------------------------以上引自(动力节点Oracle入门教程)-----------------------------------
	1.自治事务(PRAGMA AUTONOMOUS_TRANSACTION)
		在Oracle中，一个事务是从执行第一个数据管理语言(DML)语句开始，直到执行一个COMMIT语句，提交保存这个事务，或者执行一个ROLLBACK语句，放弃此次操作结束。
		事务的“要么全部完成，要么都没完成”的本性会使将错误信息记入数据库表中变得很困难，因为当事务失败重新运行时，用来编写日志条目的INSERT语句还未完成。
		针对这种困境，Oracle提供了一种便捷的方法，即自治事务。自治事务从当前事务开始，在其自身的语境中执行。它们能独立地被提交或重新运行，而不影响正在运行的事务。正因为这样，它们成了编写错误日志表格的理想形式。在事务中检测到错误时，您可以在错误日志表格中插入一行并提交它，然后在不丢失这次插入的情况下回滚主事务。
	2.多版本控制
		一个条目放在重做日志中,Oracle会在这里存储足够多的信息来重做或"前滚"事务
			对于插入,这个条目就是插入的行
			对于删除,则是一个消息(要删除的文件X,块Y,行槽Z中的行)
		另一个条目是撤销条目,写至一个undo段,如果事务失败,需要撤销事务外,Oracle还会用它撤销读数据块时对块做出的改变,也就是说会把块回复到查询开始时的状态,这样的话,就能够通过一个锁正确的读取数据,不仅可以得到正确一致的答案,也不会锁定任何数据
		<span class="image featured"><img src="{{ 'assets/images/other/OracleMVCC.jpg' | relative_url }}" alt="" /></span>
	注:
		定义:
			数据库:物理操作系统文件或磁盘的集合,使用Oracle的自动存储管理或RAW分区时,数据库可能不作为操作系统中单独的文件.
			实例:一组Oracle后台进程/线程以及一个共享内存区,这些内存由同一个计算机上运行的线程/进程所共享,这里可以维护易失的,非持久性内容.就算没有磁盘存储,数据库实例也能存在.
		两者关系:
			数据库可以由多个实例装载和打开,而实例可以在任何时间点装载和打开已数据库.实际上,准确的讲,实例在其整个生存期中最多能装载和打开一个数据库.
	3.文件
		实例相关
			1.参数文件(大多.ora文件):Oracle实例在哪里可以找到控制文件,并且制定某些初始化参数,这些参数定义了某种内存结构有多大等的设置.
			2.跟踪文件:服务器进程对某种异常错误条件做出相应时创建的诊断文件.
			3.警告文件:与跟踪文件类似,包含期望时间的有关信息,并且通过一个集中式文件
		数据库文件
			4.数据文件:是数据库的主要文件,其中包括数据表,索引和所有其他的段
			5.临时文件:这些文件用于完成基于磁盘的排序和临时存储
			6.控制文件:数据文件,临时文件和重做日志文件在哪里,还会支出与文件状态有关的其他元数据.
			7.重做日志文件:就是事务文件
			8.密码文件:通过网络完成管理活动的用户进行认证.
		从10g开始又新增了两个文件
			9.修改跟踪文件:有利于对Oracle数据建立真正的增量备份,修改跟踪文件不一定非得放在闪回恢复区,不过它只与数据库备份和恢复有关,所以我们将在介绍闪回恢复区时再讨论这个文件
			10.闪回日志文件:存储数据库块的前映象,以便完成新增加的FLASHBACK DATABASE命令
		其他文件
			11.转储文件:由Export(导出)数据库实用程序生成,并由Import(导入)数据库实用程序使用
			12.数据泵文件:Oracle数据泵导出进程生成,并由数据泵导入进程使用,外部表也可以创建和使用这种文件格式
			13.平面文件:这些无格式文件可以在文本编辑器中查看,通常会使用这些文件项数据库中加载数据
</pre>